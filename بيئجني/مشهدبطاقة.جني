ئورد مكون، عنصرمخصص، عنصرئشتمل، عنصر؛
ئورد حدت، حدتمخصص؛
ئورد المستند من مستند؛
ئورد النافدة من نافدة؛
ئورد مسترمز من مكون.مسترمز؛
ئورد مختطبطاقة، ئنشئبطاقة من مختطة؛
ئورد الكل ك قاعدب من قاعدب؛

ئورد طافية من مكون.طافية؛

ئعلن مشهدبطاقة ():
	يمدد مكون()؛
	
	يملك حدت _عندغلقبطاقة؛
	
	هدا._حالة = {
		بطاقة: عدم
	}؛
تم

ئعلن مشهدبطاقة.حممل ():
	هدا.ئربطحدتين()؛
	مسترمز مسترم = هدا.ئستعلم((<مسترمز>))؛
	مختطبطاقة بطاقتي = هدا._حالة.بطاقة؛
	ئدا (مسترم لا= عدم) وو (بطاقتي لا= عدم):
		مسترم.خدحالة({
			مصدر: بطاقتي.محتوا
		})؛
	تم
تم

ئعلن مشهدبطاقة.عندغلقبطاقة ():
	عنصرئشتمل ئب = المستند.ئستعلم((<مشهدبطاقات>))؛
	طافية طف = ئب.ئستعلم((<طافية>))؛
	طف.ئخفي()؛
	هدا.ئطلقحدت(حدتمخصص('غلقبطاقة'))؛
تم

ئعلن مشهدبطاقة.عندحفضبطاقة () ك وعد:
	مسترمز مسترم = هدا.ئستعلم((<مسترمز>))؛
	عنصرئشتمل حيزوحدة = هدا.ئستعلم('#حيزوحدة')؛
	نصية مساروحدة = حيزوحدة.نصداخلي؛
	نصية مصدر = مسترم._حالة['مصدر']؛
	#البطاقة ليست فارغة
	ئدا مصدر:
		مختطبطاقة بطاقتي = ئنشئبطاقة(مساروحدة، مصدر)؛
		ئدا هدا._حالة.بطاقة:
			بطاقتي._معرف = هدا._حالة.بطاقة._معرف؛
			بطاقتي._مراجعة = هدا._حالة.بطاقة._مراجعة؛
		تم
		ريتما قاعدب.قابمحلي.ئوضع(بطاقتي)؛
	تم
	هدا.عندغلقبطاقة()؛
تم

ئعلن مشهدبطاقة.صيير ():
	عدد طول = النافدة.طولداخلي - 170؛
	مختطبطاقة بطاقة = هدا._حالة.بطاقة؛
	نصية مساروحدة = هدا._حالة.بطاقة.وحدة ئدا هدا._حالة.بطاقة وئلا ''؛
	نصية عنوان = هدا._حالة.بطاقة.عنوان ئدا (هدا._حالة.بطاقة لا= عدم) وو (هدا._حالة.بطاقة.عنوان لا= عدم) وئلا ''؛
	ئرجع (
		<قسم صنف="مخطط-طولي فجوة-3 حش-4">
			<قسم صنف="مخطط-عرضي ئصفف-وسط ئرصف-وسط فجوة-3 نص-ئبيض">
				<ئيقو ئسم="سهم-تصفح-يمين" صنف="مئشر-سبابة نصكجج" عندنقر="عندغلقبطاقة"></ئيقو>
				<ئدخال نوع="نص" قيمة="%{عنوان}" ستنب="عنوان" صنف="نصكب يكبر نص-ئبيض خلف-حيادي-800 ئطاربلا"></ئدخال>
				<ئيقو ئسم="تلاتنقط-عمودي" صنف="مئشر-سبابة نصكجج"></ئيقو>
			</قسم>
			
			<شرط>
				<عند تحقق="بطاقة">
					<مسترمز صنف="يكبر فلكس" طول="%{طول}px"></مسترمز>
				</عند>
			</شرط>
			
			<قسم صنف="مخطط-عرضي">
				<قسم صنف="مخطط-عرضي ئصفف-وسط ئرصف-وسط فجوة-3 نص-ئبيض ئطار-رمادي-700 حشص-1 حشس-2 مقوس ئطار1">
					<ئيقو ئسم="مربع-قوس-كود"></ئيقو>
					<قسم صنف="مخطط-عرضي">
						<حيز>/</حيز>
						<حيز معرف="حيزوحدة">%{مساروحدة}</حيز>
					</قسم>
				</قسم>
			</قسم>
			
			<قسم صنف="مخطط-عرضي ئرصف-بين ئصفف-وسط">
				<قسم صنف="مخطط-عرضي فجوة-1 نص-ئبيض">
					<ئيقو ئسم="حادي-يمين" صنف="مئشر-سبابة نصكج مقوسكامل تئشير:خلف-حيادي-700 حشص-2 حشس-3"></ئيقو>
					<ئيقو ئسم="تكرار" صنف="مئشر-سبابة نصكج مقوسكامل تئشير:خلف-حيادي-700 حشص-2 حشس-3"></ئيقو>
					<ئيقو ئسم="تراجع" صنف="مئشر-سبابة نصكج مقوسكامل تئشير:خلف-حيادي-700 حشص-2 حشس-3"></ئيقو>
					<ئيقو ئسم="نسخ" صنف="مئشر-سبابة نصكج مقوسكامل تئشير:خلف-حيادي-700 حشص-2 حشس-3"></ئيقو>
					<ئيقو ئسم="قمامة" صنف="مئشر-سبابة نصكج مقوسكامل تئشير:خلف-حيادي-700 حشص-2 حشس-3"></ئيقو>
				</قسم>
				<حيز عندنقر="عندحفضبطاقة" صنف="مئشر-سبابة خطسميك نص-ئبيض مقوسكب حشس-6 حشص-2 تئشير:خلف-حيادي-700">حفض</حيز>
			</قسم>
			
		</قسم>
	)؛
تم

ئعلن مدخل ():
	عنصرمخصص.سججل('مشهدبطاقة'، مشهدبطاقة)؛
تم
